---
title: "Exploration"
title-block-banner: false
description: | 
  Cette page présente une exploration des différentes données ainsi qu'une analyse descriptive et statistique des ces différentes variables.
# à changer
date: "2022-12-21"
# Modifier les détails que vous voulez
author:
  - name: "Juliette Leblanc"
    # Votre site web perso ou github
    url: https://github.com/JulLeblanc
    # les champs d'affiliation sont optionnels, vous pouvez les
    # comment out en ajoutant un # devant.
    affiliation: FAS1002
    affiliation-url: https://FAS1002.github.io/A22
    # changer pour votre propre orcid id
    # https://orcid.org/ pour vous inscrire.
    # orcid: 0000-0000-0000-0000

# TRUE == Générer une citation pour cette page précise. Pour enlever, mettre false.
citation: true
# Inclure les références que vous utilisez dans vos rapports. Je conseille Zotero pour construire
# ce fichier ou de connecter RStudio directement pour pouvoir citer avec @nom-de-reference.
bibliography: references.bib
---

NB : Ouvrir la bribe de code pour voir les `packages` nécessaires à l'importation et la manipulation des données.

```{r importing processed, warning=FALSE, error=FALSE, message=FALSE}
library(tidyverse)
library(fs)
library(lubridate)
library(skimr)
library(gapminder)
library(countrycode)
library(cronR)
library(modelsummary)
library(patchwork)

df_owid <- read_csv("data/processed/dat_CO2.csv", show_col_types = FALSE)

df_gapminder <- read_csv("data/processed/datgm.csv", show_col_types = FALSE)
```

## Statistiques descriptives

### *Life Expectancy at Birth*

La première est celle du *Life Expectancy* qui comprend au total 5 variables et plus de 56616 observations. Cette banque de données et mis à jour régulièrement et continent des observations pour :

-   Un total de 195 pays

-   Calculées depuis 1800 et estiment l'espérance de vie moyenne pour les différents pays jusqu'en 2100.

-   La banque de donnée regroupe les pays sous les 5 continents principaux soit l'Afrique, les Amériques, l'Asie, l'Europe et l'Océanie.

Voici notamment un récapitulatif des données.

```{r}
skim(df_gapminder)
```

Il est possible aussi d'observer l'évolution de l'espérance de vie moyenne en fonction des continents. Les grandes cassures dans le temps peuvent être attribuables à différentes périodes historiques.

Notamment, la grand cassure avant les années 1920 peuvent être à la fois attribuables à la Première Guerre mondiale, mais également à l'épidémie de la Grippe espagnole. La même tendance est observable dans les années 1940 pour la Seconde Guerre mondiale et plus récemment, la légère fracture pour la pandémie de la COVID-19.


```{r graph for life expectancy, warning=FALSE, error=FALSE, message=FALSE}
graph <- df_gapminder |> 
    group_by(continent,
             year) |> 
    mutate(mean_continent = mean(life_exp, na.rm = TRUE)) |> 
    ungroup() |> 
    group_by(year) |> 
    mutate(mean_world = mean(life_exp, na.rm = TRUE))
    

p1 <- ggplot() +
    geom_line(data = graph,
             aes(x = year,
                 y = mean_continent,
                 color = continent)) +
    scale_x_continuous(n.breaks = 12) +
    scale_color_discrete(name = "Continents",
                         labels = c("Afrique",
                                    "Amériques",
                                    "Asie",
                                    "Europe",
                                    "Océanie")) +
    theme_bw() + 
    labs(title = "Évolution de l'espérance de vie",
         source = "https://ourworldindata.org/co2-and-other-greenhouse-gas-emissions",
         x = " ",
         y = " ") 
p1 



p2 <-  ggplot(data = graph,
              aes(x = year,
                      y = mean_world)) +
    geom_line() +
    scale_x_continuous(n.breaks = 12) +
    theme_bw() + 
    labs(title = "Évolution de l'espérance de vie mondiale",
         source = "https://ourworldindata.org/co2-and-other-greenhouse-gas-emissions",
         x = " ",
         y = " ")

p2

```

### *Our World in Data, Co2*

La banque de données est [*\@owid*](https://raw.githubusercontent.com/owid/co2-data/master/owid-co2-data.csv), qui a comme but principal de décrire comment les émissions de Co2 et de gaz à effets de serres évoluent dans le temps.

La banque de données présentent plus de :

-   75 variables comme le PIB, le nombre d'habitants dans le pays, l'année et une variable qui a été ajouté et celle qui regroupe les pays sous les 5 continents,

-   Différentes mesures pour le Co2 comme l'émissions brutes, l'accumulation ou bien le rendement par énergie dépensé, etc.

-   Les données enregistrées sont mise à jour de manière presqu'hebdomadaire et ont des observations débutants en 1750.

Puisque la banque de données regroupent de nombreuses variables, une sélection des plus importantes pour les analyses qui suivront a été fait. Les variables qui ont été retenues sont celles du :

-   Pays `country`,

-   Années `year`,

-   Continents `continent`,

-   PIB `gdp`,

-   Nombre d'habitants total `population`,

-   Co2 `co2`,


```{r}
owid <- df_owid |> 
    select(country,
           year,
           continent,
           gdp,
           population,
           co2)
```

```{r}
skim(owid)
```

```{r co2 evolution world}
graph_owid_world <- df_owid |> 
    filter(country == "World") |> 
    select(co2,
           year,
           country)

ggplot(data = graph_owid_world,
       aes(x = year,
           y = co2)) +
    geom_line() +
    scale_x_continuous(n.breaks = 12) +
    scale_y_continuous(n.breaks = 5) +
    geom_point(size = 0.3) +
    labs(title = "Co2 total mondial") +
    theme_bw()

```


```{r graph for co2 emission, warning=FALSE, error=FALSE, message=FALSE}
graph_owid <- df_owid |> 
    filter(is.na (continent) == FALSE,
           is.na (co2) == FALSE) |> 
    group_by(continent,
             year) |> 
    select(co2)

p3 <- ggplot(data = graph_owid,
             aes(x = year,
                 y = co2,
                 color = continent)) +
    geom_line(stat = "identity") +
    # scale_color_discrete(name = "Continents",
    #                      labels = c("Afrique",
    #                                 "Amériques",
    #                                 "Asie",
    #                                 "Europe",
    #                                 "Océanie")) +
    theme_bw()
p3
```

```{r}
ggplot(data = graph_owid,
       aes(x = year,
           y = co2,
           colour = continent)) +
    geom_point(size = 0.3) +
    theme_bw()
```

Plus de CO2 en 2021
```{r}
df_owid |> 
    filter(year == 2021) |> 
    select(country,
           co2) |> 
    arrange(desc(co2))

```

co2 en 2021 : world is 37 milliards de tonnes?
Chine - 11 millards (Asie 21)
USA - 5007



```{r}
top_5 <- df_owid |> 
    filter(country == c("China",
                        "United States",
                        "India",
                        "Russia",
                        "India")) |> 
    select(year,
           co2,
           country)


ggplot(top_5) +
    aes(x = year,
        y = co2,
        fill = country) +
    geom_area(alpha = 0.4) +
    scale_fill_hue(direction = 1) +
    geom_line(data = graph_owid_world,
              aes(x = year,
                  y = co2,
                  fill = country),
              alpha = 0.5) +
    theme_bw() 
    
```
Sommes
```{r}
pourcentage <-  df_owid |> 
    filter(country == c("China",
                        "United States",
                        "India",
                        "Russia",
                        "India"),
           year >= 2000) |>
        group_by(year) |> 
    select(year,
           co2,
           country) |> 
    mutate(sum = sum(co2, na.rm = TRUE))

ggplot(pourcentage,
       aes(x = year,
           y = sum)) +
    geom_line()
```


Pays riches qui produisent le plus de co2 ? apparently yes
```{r}
rich <- df_owid |> 
    filter (country == c("Upper-middle-income countries",
                         "High-income countries",
                         "Lower-middle-income countries",
                         "Low-income countries")) |> 
    select(country,
           co2,
           year,
           gdp)

ggplot(data = rich,
       aes(x = year,
           y = co2,
           fill = country)) +
    geom_area(alpha = 0.3) +
        geom_line(data = graph_owid_world,
              aes(x = year,
                  y = co2,
                  fill = country),
              alpha = 0.5) +
    theme_bw()
```

```{r}
life_exp_co2 <- df_gapminder |> 
    filter (country == c("China",
                        "United States",
                        "India",
                        "Russia")) |> 
    select(life_exp,
           country,
           year)

ggplot(data = life_exp_co2,
       aes(x = year,
           y = life_exp,
            color = country)) +
    geom_line() +
    theme_bw() 
```

## Combinaison

On peut également entreprendre des analyses via la combinaison des deux banques de données puisqu'elles ont comme variables communes les années, les continents ainsi que la majorité des pays observés.

```{r inner join, warning=FALSE, error=FALSE, message=FALSE}

dat <- inner_join(x = df_gapminder,
                  y = owid)

skim(dat)

```





