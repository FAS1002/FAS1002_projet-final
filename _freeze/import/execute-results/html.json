{
  "hash": "318bd4bab310d508c10aecc54e7ecb4a",
  "result": {
    "markdown": "---\ntitle: \"What are we dealing with?\"\nauthor: \"Cécile Amadoro\"\nurl: \ntitle-block-banner: false\ndescription: | \n  Cette partie présente rapidement les deux bases de données utilisées ainsi que la méthode d'importation.\n \ndate: \"2022-12-20\"\n\n# TRUE == Générer une citation pour cette page précise. Pour enlever, mettre false.\ncitation: true\n# Inclure les références que vous utilisez dans vos rapports. Je conseille Zotero pour construire\n# ce fichier ou de connecter RStudio directement pour pouvoir citer avec @nom-de-reference.\nbibliography: references.bib\n---\n\n::: {.cell}\n\n:::\n\n\n### [Introduction]{.underline}\n\nLe présent projet travaille avec deux bases de données : La première est issue de Our World in Data, un site qui publie gratuitement des bases de données et de la recherche sur les enjeux contemporains que le monde traverse (économie, écologie, climat, énergie, conflits etc).\\\nLa deuxième base de donnée est issue de Gapminder, une OBNL suèdoise, qui propose en libre accès d'importantes bases de données aussi sur les enjeux actuels, dans le but de prévenir et lutter contre la mésinformation.\n\n### [**I. Importation quotidienne des données CO2 (Our World in Data)**]{.underline}\n\nLa base de donnée \"*CO2 & Greenhouse Gas Emissions*\" est utilisée. Elle permet de faire différentes explorations statistiques sur les émissions de CO2 dans 207 pays depuis le 19ème siècle.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Données CO2 d'OWID\n\nurlowid = \"https://raw.githubusercontent.com/owid/co2-data/master/owid-co2-data.csv\"\nbasepath =  path(\"data\", \"raw\") \nfnameowid = paste(today(), \"owid-co2-data.csv\", sep = \"_\") \nfpathowid = path(basepath, fnameowid) \ndataowid = download.file(url = urlowid, destfile = fpathowid)\n\ndat_owid = read_csv(fpathowid)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nRows: 46523 Columns: 74\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr  (2): country, iso_code\ndbl (72): year, population, gdp, cement_co2, cement_co2_per_capita, co2, co2...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n:::\n\n```{.r .cell-code}\n#Automatisation du script avec cronR, fréquence de téléchargement quotidienne\n\n#cronR::cron_add(download.file(urlowid, destfile = fpathowid), frequency = \"daily\", at = \"9AM\")\n\n#Confirmation de l'automatisation dans la console. \n#Are you sure you want to add the specified cron job: '0'? [y/n]: 1: y \n#Adding cronjob:\n## cronR job\n## id:   d2f75e2df797c02be775f141f081109f\n## tags: \n## desc: \n```\n:::\n\n\n### [**II. Importation mensuelle des données Gapminder**]{.underline}\n\nLa base de données \"*Life Expectancy at Birth*\" est utilisée. Elle permet aussi de faire des analyses statistiques sur la question de l'espérance de vie depuis le 19ème siècle. L'espérance de vie est aujourd'hui un des meilleurs indicateurs de développement d'un pays ainsi qu'une solide mesure de projection économique et démographique.\\\nCette base de données contient au total 1505 observations\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Données gapminder\nlibrary(gsheet)\n\n#Utilisation de la fonction gsheet2tbl du package gsheet qui permet de convertir facilement une sheet google en dataframe\n\nurlgapminder =  gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1RheSon1-q4vFc3AGyupVPH6ptEByE-VtnjOCselU0PE/edit#gid=176703676\")\n\n#incorporation dans data/raw\nbasepathgm = path(\"data\", \"raw\")\n\nfnamegm = paste(today(), \"gapm.csv\", sep = \"_\")\n\nfpathgm = path(basepathgm, fnamegm)\n\nwrite_csv(x = urlgapminder, file = fpathgm)\n\ndatgm = read_csv(fpathgm)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nRows: 56616 Columns: 4\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (2): geo, name\ndbl (2): time, Life expectancy\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n:::\n\n```{.r .cell-code}\n#Automatisation du script avec cronR, fréquence de téléchargement mensuelle\n\n#cronR::cron_add(gsheet2tbl(\"https://docs.google.com/spreadsheets/d/1RheSon1-q4vFc3AGyupVPH6ptEByE-VtnjOCselU0PE/edit#gid=176703676\") %>%\n                    #path(\"data\", \"raw\") %>%\n                    #paste(today(), \"gapm.csv\", sep = \"_\") %>%\n                    #path(basepathgm, fnamegm) %>% \n                    #write_csv(x = urlgapminder, file = fpathgm),\n        #frequency = \"monthly\",\n        #at = \"9AM\")\n\n\n#Corriger bug : Error in path_tidy(.Call(fs_path_, lapply(args, function(x) enc2utf8(as.character(x))),  :  Total path length must be less than PATH_MAX: 1024\n```\n:::\n\n\n### [**III. Manipulation des données**]{.underline}\n\nLa base de données CO2 contient 46.523 observations regroupé en 74 variables. Cette base de données propose de mieux comprendre les sources d'énergies dans 207 pays.\\\nPour obtenir une meilleure lecture et analyse des données, il est apparu plus simple de traiter la base de données CO2 avec quelques variables et non dans sa totalité. Au total, 18 sur 74 variables ont été selctionnées.\n\nPour mieux comprendre les variables, le tableau suivant propose le codebook suivant, adapté du [codebook original](https://github.com/owid/co2-data/blob/master/owid-co2-codebook.csv) .\n\n| Variable              | Description + Type                                                                                                                                                                                                                                        |\n|----------------|--------------------------------------------------------|\n| Country               | pays (character)                                                                                                                                                                                                                                          |\n| Year                  | année de l'observation (numérique)                                                                                                                                                                                                                        |\n| Iso_code              | code du pays selon la codification internationale 3166-1 (character)                                                                                                                                                                                      |\n| Population            | Nombre total de la population selon le pays (numérique)                                                                                                                                                                                                   |\n| GDP (PIB)             | Produit interieur brut mesuré en dollars (numérique)                                                                                                                                                                                                      |\n| CO2                   | Mesure annuelle de la production totale de CO2 par pays, mesuré en en millions de tonnes et excluant l'[UTCATF](https://fr.wikipedia.org/wiki/Utilisation_des_terres,_changement_d'affectation_des_terres_et_foresterie) (numérique)                      |\n| Cement_CO2_per_capita | Mesure annuelle de la production totale de CO2 générée par le ciment, par personne, en millions de tonnes (numérique)                                                                                                                                     |\n| CO2_per_gdp           | Mesure annuelle de la production totale de CO2 selon le PIB, excluant l'UTCATF (numérique)                                                                                                                                                                |\n| coal_co2              | Mesure annuelle par pays de la production de CO2 générée par le charbon, en millions de tonnes (numérique)                                                                                                                                                |\n| coal_co2_per_capita   | Mesure annuelle de la production de CO2 générée par le charbon, mesurée en million de tonnes par personnes (numérique)                                                                                                                                    |\n| methane               | Total annuel des émissions de méthane par pays, incluant l'UTCATF, mesuré en millions de tonnes (numérique)                                                                                                                                               |\n| methane_per_capita    | Total annuel des émissions de méthane par habitant, incluant l'UTCATF, mesuré en millions de tonnes (numérique)                                                                                                                                           |\n| oil_co2               | Mesure annuelle par pays de la production de CO2 générée par le pétrole, en millions de tonnes (numérique)                                                                                                                                                |\n| oil_co2_per_capita    | Mesure annuelle de la production de CO2 générée par le pétrole, mesurée en million de tonnes par personnes (numérique)                                                                                                                                    |\n| ghg_per_capita        | Total des émissions de gas à effet de serres par personne, mesuré en tonne de de millions, incluant l'UTCATF (numérique)                                                                                                                                  |\n| trade_co2             | Total annuel des émissions de C02, issu du commerce, mesuré en million de tonne. (Ici une valeur positive veut dire qu'un pays est un importeur net d'émission de CO2 ; une valeur négative veut dire qu'un pays est un exporteur net d'émission de CO2). |\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Transformation des données en tibble\nas.tibble(dat_owid)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: `as.tibble()` was deprecated in tibble 2.0.0.\nℹ Please use `as_tibble()` instead.\nℹ The signature and semantics have changed, see `?as_tibble`.\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 46,523 × 74\n   country      year iso_c…¹ popul…²   gdp cemen…³ cemen…⁴   co2 co2_g…⁵ co2_g…⁶\n   <chr>       <dbl> <chr>     <dbl> <dbl>   <dbl>   <dbl> <dbl>   <dbl>   <dbl>\n 1 Afghanistan  1850 AFG     3752993    NA      NA      NA    NA      NA      NA\n 2 Afghanistan  1851 AFG     3769828    NA      NA      NA    NA      NA      NA\n 3 Afghanistan  1852 AFG     3787706    NA      NA      NA    NA      NA      NA\n 4 Afghanistan  1853 AFG     3806634    NA      NA      NA    NA      NA      NA\n 5 Afghanistan  1854 AFG     3825655    NA      NA      NA    NA      NA      NA\n 6 Afghanistan  1855 AFG     3844769    NA      NA      NA    NA      NA      NA\n 7 Afghanistan  1856 AFG     3863976    NA      NA      NA    NA      NA      NA\n 8 Afghanistan  1857 AFG     3883276    NA      NA      NA    NA      NA      NA\n 9 Afghanistan  1858 AFG     3902671    NA      NA      NA    NA      NA      NA\n10 Afghanistan  1859 AFG     3922160    NA      NA      NA    NA      NA      NA\n# … with 46,513 more rows, 64 more variables: co2_including_luc <dbl>,\n#   co2_including_luc_growth_abs <dbl>, co2_including_luc_growth_prct <dbl>,\n#   co2_including_luc_per_capita <dbl>, co2_including_luc_per_gdp <dbl>,\n#   co2_including_luc_per_unit_energy <dbl>, co2_per_capita <dbl>,\n#   co2_per_gdp <dbl>, co2_per_unit_energy <dbl>, coal_co2 <dbl>,\n#   coal_co2_per_capita <dbl>, consumption_co2 <dbl>,\n#   consumption_co2_per_capita <dbl>, consumption_co2_per_gdp <dbl>, …\n```\n:::\n\n```{.r .cell-code}\n#Filtrage du tibble\n\ndat_CO2 = dat_owid %>% \n    select(country, year, iso_code, population, gdp, co2, cement_co2_per_capita, \n           co2_per_gdp, coal_co2, coal_co2_per_capita, gas_co2, gas_co2_per_capita,\n           methane, methane_per_capita, oil_co2, oil_co2_per_capita, ghg_per_capita, trade_co2)\n\n\n#Ajout dans de dat_CO2 data/processed \n\nwrite_csv(dat_CO2, file = \"data/processed/dat_CO2.csv\")\n```\n:::\n\n\nN'oubliez pas d'inclure vos références sur chacune des pages!\n\n> Les données proviennent entre autres de @owidenergy.\n",
    "supporting": [
      "import_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}